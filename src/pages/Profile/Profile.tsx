import React from 'react'
import { useAppDispatch, useAppSelector } from '../../hooks/redux'
import { logout, selectAccessToken, useGetUserInfoQuery } from '../../redux/reducers/userSlice'
import { NavLink, useNavigate } from 'react-router-dom'
import * as styles from './styles'
import StringHelper from '../../helpers/stringHelper'

const Profile = () => {
    const dispatch = useAppDispatch()
    const login = useAppSelector(selectAccessToken)
    const navigate = useNavigate()
    const accessToken = useAppSelector(selectAccessToken)
    const {
        data: userInfo,
        isLoading,
    } = useGetUserInfoQuery({ accessToken: accessToken! }, { skip: accessToken === undefined })

    const onLogoutClick = () => {
        login && dispatch(logout())
        navigate('/')
    }

    return (
        <styles.Page>
            <styles.Title>Profile</styles.Title>
            <styles.MainPart>
                <styles.LeftSide>
                    <styles.BasicInfo>
                        <styles.ImageWrapper>
                            { userInfo && <styles.Image src={ userInfo.picture }/> }
                        </styles.ImageWrapper>
                        <styles.Username>
                            { userInfo && userInfo.name }
                        </styles.Username>
                        <styles.PhoneNumber>
                            { userInfo && StringHelper.formatPhoneNumber(userInfo.phone_number) }
                        </styles.PhoneNumber>
                    </styles.BasicInfo>
                    <styles.TabList>
                        <NavLink to={ '.' } className={ ({ isActive }) => isActive ? 'active' : undefined }>
                            <styles.IconWithText>
                                <svg width="20" height="21" viewBox="0 0 20 21" fill="none"
                                     xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M20 5.24C20.0008 5.10839 19.9756 4.97793 19.9258 4.85609C19.876 4.73426 19.8027 4.62344 19.71 4.53L15.47 0.290001C15.3766 0.19732 15.2658 0.123995 15.1439 0.0742302C15.0221 0.0244656 14.8916 -0.000759438 14.76 1.4555e-06C14.6284 -0.000759438 14.4979 0.0244656 14.3761 0.0742302C14.2543 0.123995 14.1435 0.19732 14.05 0.290001L11.22 3.12L0.290017 14.05C0.197335 14.1434 0.12401 14.2543 0.0742455 14.3761C0.0244809 14.4979 -0.000744179 14.6284 1.67143e-05 14.76V19C1.67143e-05 19.2652 0.105374 19.5196 0.29291 19.7071C0.480446 19.8946 0.7348 20 1.00002 20H5.24002C5.37994 20.0076 5.51991 19.9857 5.65084 19.9358C5.78176 19.8858 5.90073 19.8089 6.00002 19.71L16.87 8.78L19.71 6C19.8013 5.90308 19.8757 5.79153 19.93 5.67C19.9397 5.59029 19.9397 5.50971 19.93 5.43C19.9347 5.38345 19.9347 5.33655 19.93 5.29L20 5.24ZM4.83002 18H2.00002V15.17L11.93 5.24L14.76 8.07L4.83002 18ZM16.17 6.66L13.34 3.83L14.76 2.42L17.58 5.24L16.17 6.66Z"
                                        fill="#465564"/>
                                </svg>
                                <span>Edit profile</span>
                            </styles.IconWithText>
                        </NavLink>
                        <styles.TabBar to={ './changePassword' }>
                            <styles.IconWithText>
                                <svg width="20" height="20" viewBox="0 0 16 20" fill="none"
                                     xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M8 11C7.73478 11 7.48043 11.1054 7.29289 11.2929C7.10536 11.4804 7 11.7348 7 12V15C7 15.2652 7.10536 15.5196 7.29289 15.7071C7.48043 15.8946 7.73478 16 8 16C8.26522 16 8.51957 15.8946 8.70711 15.7071C8.89464 15.5196 9 15.2652 9 15V12C9 11.7348 8.89464 11.4804 8.70711 11.2929C8.51957 11.1054 8.26522 11 8 11ZM13 7V5C13 3.67392 12.4732 2.40215 11.5355 1.46447C10.5979 0.526784 9.32608 0 8 0C6.67392 0 5.40215 0.526784 4.46447 1.46447C3.52678 2.40215 3 3.67392 3 5V7C2.20435 7 1.44129 7.31607 0.87868 7.87868C0.316071 8.44129 0 9.20435 0 10V17C0 17.7956 0.316071 18.5587 0.87868 19.1213C1.44129 19.6839 2.20435 20 3 20H13C13.7956 20 14.5587 19.6839 15.1213 19.1213C15.6839 18.5587 16 17.7956 16 17V10C16 9.20435 15.6839 8.44129 15.1213 7.87868C14.5587 7.31607 13.7956 7 13 7ZM5 5C5 4.20435 5.31607 3.44129 5.87868 2.87868C6.44129 2.31607 7.20435 2 8 2C8.79565 2 9.55871 2.31607 10.1213 2.87868C10.6839 3.44129 11 4.20435 11 5V7H5V5ZM14 17C14 17.2652 13.8946 17.5196 13.7071 17.7071C13.5196 17.8946 13.2652 18 13 18H3C2.73478 18 2.48043 17.8946 2.29289 17.7071C2.10536 17.5196 2 17.2652 2 17V10C2 9.73478 2.10536 9.48043 2.29289 9.29289C2.48043 9.10536 2.73478 9 3 9H13C13.2652 9 13.5196 9.10536 13.7071 9.29289C13.8946 9.48043 14 9.73478 14 10V17Z"
                                        fill="#465564"/>
                                </svg>
                                <span>Change password</span>
                            </styles.IconWithText>
                        </styles.TabBar>
                        <styles.TabBar to={ './reservations' }>
                            <styles.IconWithText>
                                <svg width="20" height="22" viewBox="0 0 20 22" fill="none"
                                     xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M10 18C10.1978 18 10.3911 17.9414 10.5556 17.8315C10.72 17.7216 10.8482 17.5654 10.9239 17.3827C10.9996 17.2 11.0194 16.9989 10.9808 16.8049C10.9422 16.6109 10.847 16.4327 10.7071 16.2929C10.5673 16.153 10.3891 16.0578 10.1951 16.0192C10.0011 15.9806 9.80004 16.0004 9.61732 16.0761C9.43459 16.1518 9.27841 16.28 9.16853 16.4444C9.05865 16.6089 9 16.8022 9 17C9 17.2652 9.10536 17.5196 9.29289 17.7071C9.48043 17.8946 9.73478 18 10 18ZM15 18C15.1978 18 15.3911 17.9414 15.5556 17.8315C15.72 17.7216 15.8482 17.5654 15.9239 17.3827C15.9996 17.2 16.0194 16.9989 15.9808 16.8049C15.9422 16.6109 15.847 16.4327 15.7071 16.2929C15.5673 16.153 15.3891 16.0578 15.1951 16.0192C15.0011 15.9806 14.8 16.0004 14.6173 16.0761C14.4346 16.1518 14.2784 16.28 14.1685 16.4444C14.0586 16.6089 14 16.8022 14 17C14 17.2652 14.1054 17.5196 14.2929 17.7071C14.4804 17.8946 14.7348 18 15 18ZM15 14C15.1978 14 15.3911 13.9414 15.5556 13.8315C15.72 13.7216 15.8482 13.5654 15.9239 13.3827C15.9996 13.2 16.0194 12.9989 15.9808 12.8049C15.9422 12.6109 15.847 12.4327 15.7071 12.2929C15.5673 12.153 15.3891 12.0578 15.1951 12.0192C15.0011 11.9806 14.8 12.0004 14.6173 12.0761C14.4346 12.1518 14.2784 12.28 14.1685 12.4444C14.0586 12.6089 14 12.8022 14 13C14 13.2652 14.1054 13.5196 14.2929 13.7071C14.4804 13.8946 14.7348 14 15 14ZM10 14C10.1978 14 10.3911 13.9414 10.5556 13.8315C10.72 13.7216 10.8482 13.5654 10.9239 13.3827C10.9996 13.2 11.0194 12.9989 10.9808 12.8049C10.9422 12.6109 10.847 12.4327 10.7071 12.2929C10.5673 12.153 10.3891 12.0578 10.1951 12.0192C10.0011 11.9806 9.80004 12.0004 9.61732 12.0761C9.43459 12.1518 9.27841 12.28 9.16853 12.4444C9.05865 12.6089 9 12.8022 9 13C9 13.2652 9.10536 13.5196 9.29289 13.7071C9.48043 13.8946 9.73478 14 10 14ZM17 2H16V1C16 0.734784 15.8946 0.48043 15.7071 0.292893C15.5196 0.105357 15.2652 0 15 0C14.7348 0 14.4804 0.105357 14.2929 0.292893C14.1054 0.48043 14 0.734784 14 1V2H6V1C6 0.734784 5.89464 0.48043 5.70711 0.292893C5.51957 0.105357 5.26522 0 5 0C4.73478 0 4.48043 0.105357 4.29289 0.292893C4.10536 0.48043 4 0.734784 4 1V2H3C2.20435 2 1.44129 2.31607 0.87868 2.87868C0.316071 3.44129 0 4.20435 0 5V19C0 19.7956 0.316071 20.5587 0.87868 21.1213C1.44129 21.6839 2.20435 22 3 22H17C17.7956 22 18.5587 21.6839 19.1213 21.1213C19.6839 20.5587 20 19.7956 20 19V5C20 4.20435 19.6839 3.44129 19.1213 2.87868C18.5587 2.31607 17.7956 2 17 2ZM18 19C18 19.2652 17.8946 19.5196 17.7071 19.7071C17.5196 19.8946 17.2652 20 17 20H3C2.73478 20 2.48043 19.8946 2.29289 19.7071C2.10536 19.5196 2 19.2652 2 19V10H18V19ZM18 8H2V5C2 4.73478 2.10536 4.48043 2.29289 4.29289C2.48043 4.10536 2.73478 4 3 4H4V5C4 5.26522 4.10536 5.51957 4.29289 5.70711C4.48043 5.89464 4.73478 6 5 6C5.26522 6 5.51957 5.89464 5.70711 5.70711C5.89464 5.51957 6 5.26522 6 5V4H14V5C14 5.26522 14.1054 5.51957 14.2929 5.70711C14.4804 5.89464 14.7348 6 15 6C15.2652 6 15.5196 5.89464 15.7071 5.70711C15.8946 5.51957 16 5.26522 16 5V4H17C17.2652 4 17.5196 4.10536 17.7071 4.29289C17.8946 4.48043 18 4.73478 18 5V8ZM5 14C5.19778 14 5.39112 13.9414 5.55557 13.8315C5.72002 13.7216 5.84819 13.5654 5.92388 13.3827C5.99957 13.2 6.01937 12.9989 5.98079 12.8049C5.9422 12.6109 5.84696 12.4327 5.70711 12.2929C5.56725 12.153 5.38907 12.0578 5.19509 12.0192C5.00111 11.9806 4.80004 12.0004 4.61732 12.0761C4.43459 12.1518 4.27841 12.28 4.16853 12.4444C4.05865 12.6089 4 12.8022 4 13C4 13.2652 4.10536 13.5196 4.29289 13.7071C4.48043 13.8946 4.73478 14 5 14ZM5 18C5.19778 18 5.39112 17.9414 5.55557 17.8315C5.72002 17.7216 5.84819 17.5654 5.92388 17.3827C5.99957 17.2 6.01937 16.9989 5.98079 16.8049C5.9422 16.6109 5.84696 16.4327 5.70711 16.2929C5.56725 16.153 5.38907 16.0578 5.19509 16.0192C5.00111 15.9806 4.80004 16.0004 4.61732 16.0761C4.43459 16.1518 4.27841 16.28 4.16853 16.4444C4.05865 16.6089 4 16.8022 4 17C4 17.2652 4.10536 17.5196 4.29289 17.7071C4.48043 17.8946 4.73478 18 5 18Z"
                                        fill="#465564"/>
                                </svg>
                                <span>Reservations</span>
                            </styles.IconWithText>
                        </styles.TabBar>
                        <styles.TabBar to={ './history' }>
                            <styles.IconWithText>
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none"
                                     xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M9.44 0C6.87638 0.00731219 4.41349 0.998914 2.56 2.77V1C2.56 0.734784 2.45464 0.48043 2.2671 0.292893C2.07957 0.105357 1.82521 0 1.56 0C1.29478 0 1.04043 0.105357 0.852891 0.292893C0.665354 0.48043 0.559998 0.734784 0.559998 1V5.5C0.559998 5.76522 0.665354 6.01957 0.852891 6.20711C1.04043 6.39464 1.29478 6.5 1.56 6.5H6.06C6.32521 6.5 6.57957 6.39464 6.7671 6.20711C6.95464 6.01957 7.06 5.76522 7.06 5.5C7.06 5.23478 6.95464 4.98043 6.7671 4.79289C6.57957 4.60536 6.32521 4.5 6.06 4.5H3.66C4.57171 3.53701 5.7085 2.81576 6.96813 2.40114C8.22775 1.98651 9.57069 1.89152 10.8761 2.1247C12.1816 2.35788 13.4086 2.91193 14.4468 3.73699C15.485 4.56205 16.3018 5.63226 16.8237 6.85133C17.3457 8.0704 17.5564 9.4001 17.4369 10.7208C17.3174 12.0415 16.8715 13.3118 16.1392 14.4174C15.407 15.5231 14.4114 16.4293 13.242 17.0547C12.0726 17.68 10.7661 18.0049 9.44 18C9.17478 18 8.92043 18.1054 8.73289 18.2929C8.54535 18.4804 8.44 18.7348 8.44 19C8.44 19.2652 8.54535 19.5196 8.73289 19.7071C8.92043 19.8946 9.17478 20 9.44 20C12.0922 20 14.6357 18.9464 16.5111 17.0711C18.3864 15.1957 19.44 12.6522 19.44 10C19.44 7.34784 18.3864 4.8043 16.5111 2.92893C14.6357 1.05357 12.0922 0 9.44 0ZM9.44 6C9.17478 6 8.92043 6.10536 8.73289 6.29289C8.54535 6.48043 8.44 6.73478 8.44 7V10C8.44 10.2652 8.54535 10.5196 8.73289 10.7071C8.92043 10.8946 9.17478 11 9.44 11H11.44C11.7052 11 11.9596 10.8946 12.1471 10.7071C12.3346 10.5196 12.44 10.2652 12.44 10C12.44 9.73478 12.3346 9.48043 12.1471 9.29289C11.9596 9.10536 11.7052 9 11.44 9H10.44V7C10.44 6.73478 10.3346 6.48043 10.1471 6.29289C9.95957 6.10536 9.70521 6 9.44 6Z"
                                        fill="#465564"/>
                                </svg>
                                <span>History</span>
                            </styles.IconWithText>
                        </styles.TabBar>
                    </styles.TabList>
                    <styles.Button onClick={ onLogoutClick }>
                        Sign out
                    </styles.Button>
                </styles.LeftSide>
            </styles.MainPart>
        </styles.Page>
    )
}

export default Profile